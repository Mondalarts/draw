<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Drawing Guessing Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght400;600;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            transition: background-color 0.3s;
        }
        .container {
            max-width: 900px;
        }
        #drawingCanvas {
            border: 2px solid #3b82f6;
            background-color: white;
            touch-action: none; /* Critical for mobile drawing */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .game-button {
            transition: all 0.2s;
        }
        .game-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(59, 130, 246, 0.5);
        }
        .tool-button {
             transition: all 0.15s;
        }
        .loading-ring {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="p-4 md:p-8 flex items-center justify-center min-h-screen">

    <div class="container bg-white rounded-xl shadow-2xl p-6 md:p-10 w-full">
        <h1 class="text-3xl md:text-4xl font-extrabold text-center mb-6 text-blue-600">
            AI Sketch Guessing Game
        </h1>

        <!-- API Key Warning/Instructions -->
        <div id="apiWarning" class="p-3 mb-4 bg-red-100 border-l-4 border-red-500 text-red-700 hidden rounded-md" role="alert">
            <p class="font-bold">API Key Required</p>
            <p>Please open the console (F12) and follow the instructions to set your Gemini API Key in the `index.html` file's script section to enable the game.</p>
        </div>

        <!-- Mode Selector -->
        <div class="flex justify-center space-x-4 mb-6">
            <button id="mode1Btn" onclick="setMode(1)" class="game-button px-4 py-2 rounded-full text-white font-semibold bg-blue-600 hover:bg-blue-700 shadow-md">
                Mode 1: Free Draw & Guess
            </button>
            <button id="mode2Btn" onclick="setMode(2)" class="game-button px-4 py-2 rounded-full text-blue-600 font-semibold border-2 border-blue-600 hover:bg-blue-50">
                Mode 2: Prompted Draw & Rate
            </button>
        </div>

        <!-- Mode 2 Prompt Display -->
        <div id="mode2Prompt" class="text-center mb-4 hidden">
            <p class="text-xl font-medium text-gray-700">Your challenge: Draw a...</p>
            <p id="currentPrompt" class="text-4xl font-bold text-red-500 mt-1"></p>
        </div>
        
        <!-- Drawing Tools -->
        <div class="flex flex-wrap justify-center items-center gap-4 mb-6 p-3 bg-gray-100 rounded-lg shadow-inner">
            
            <!-- Pen Color -->
            <label for="colorPicker" class="text-gray-700 font-medium">Color:</label>
            <input type="color" id="colorPicker" value="#333333" class="w-10 h-10 rounded-lg border-2 border-gray-400 cursor-pointer">
            
            <!-- Tool Selector -->
            <button id="penBtn" onclick="setPenMode()" class="tool-button px-4 py-2 rounded-lg text-white font-semibold bg-blue-600 shadow-md">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1 inline" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zm-3.182-1.06a4 4 0 00-5.656 5.656l-3.32 3.32a1.5 1.5 0 000 2.122l5.656 5.656a1.5 1.5 0 002.122 0l3.32-3.32a4 4 0 005.656-5.656L17.707 5.707a1 1 0 00-1.414-1.414l-.943.943z"/></svg>
                Pen
            </button>
            <button id="eraserBtn" onclick="setEraserMode()" class="tool-button px-4 py-2 rounded-lg text-gray-700 font-semibold border-2 border-gray-400 hover:bg-gray-100 bg-white">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1 inline" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg>
                Eraser
            </button>

            <!-- Pen Size Slider -->
            <label for="penSizeSlider" class="text-gray-700 font-medium">Pen Size:</label>
            <input type="range" id="penSizeSlider" min="1" max="15" value="5" class="w-20 cursor-pointer accent-blue-600">
            
            <!-- Eraser Size Slider -->
            <label for="eraserSizeSlider" class="text-gray-700 font-medium">Eraser Size:</label>
            <input type="range" id="eraserSizeSlider" min="10" max="50" value="25" class="w-20 cursor-pointer accent-blue-600">

        </div>

        <!-- Canvas and Controls -->
        <div class="flex flex-col items-center">
            <canvas id="drawingCanvas" width="400" height="400" class="w-full h-auto max-h-[400px]"></canvas>

            <div class="mt-6 flex flex-wrap justify-center gap-4 w-full">
                <button onclick="clearCanvas()" class="game-button flex items-center justify-center bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm-1.06-2.828l-8.367 8.368a6 6 0 019.238-9.988z" clip-rule="evenodd" /><path fill-rule="evenodd" d="M3 10a7 7 0 1114 0 7 7 0 01-14 0zm6 1V9a1 1 0 10-2 0v2a1 1 0 102 0zm2 0V9a1 1 0 10-2 0v2a1 1 0 102 0z" clip-rule="evenodd" /></svg>
                    Clear Drawing
                </button>
                <button id="submitBtn" onclick="submitDrawing()" class="game-button flex items-center justify-center bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-lg shadow-md disabled:opacity-50" disabled>
                    <span id="submitText">Guess / Submit Drawing</span>
                    <div id="spinner" class="loading-ring ml-2 hidden"></div>
                </button>
            </div>
        </div>

        <!-- Result Display (Storyteller elements removed) -->
        <div id="resultBox" class="mt-8 p-4 md:p-6 rounded-xl text-center shadow-lg transition-all duration-300 hidden">
            <p id="resultTitle" class="text-2xl font-bold mb-2"></p>
            <p id="resultText" class="text-lg text-gray-700"></p>
        </div>
    </div>

    <script>
        // --- IMPORTANT: API Configuration for GitHub Deployment ---
        // REPLACE "YOUR_GEMINI_API_KEY_HERE" with your actual Gemini API Key.
        // Get your key here: https://ai.google.dev/gemini-api/docs/api-key
        const apiKey = "YOUR_GEMINI_API_KEY_HERE"; 
        
        let isApiKeySet = false;
        
        // Check if API key is set when the document loads
        document.addEventListener('DOMContentLoaded', () => {
            const apiWarning = document.getElementById('apiWarning');
            if (apiKey === "AIzaSyCKJI3yq4S206BxqlsLEpkc7CEjaPVAQ20" || apiKey.trim() === "") {
                apiWarning.classList.remove('hidden');
                submitBtn.disabled = true;
                isApiKeySet = false;
                console.error("!!! GEMINI API KEY MISSING !!! Please replace 'YOUR_GEMINI_API_KEY_HERE' in the index.html script to enable API calls.");
            } else {
                apiWarning.classList.add('hidden');
                isApiKeySet = true;
                // Re-enable submit button if canvas is not blank
                toggleSubmitButton(); 
            }
        });
        
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
        
        // --- Canvas Setup ---
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');
        const submitBtn = document.getElementById('submitBtn');
        const submitText = document.getElementById('submitText');
        const spinner = document.getElementById('spinner');
        const resultBox = document.getElementById('resultBox');
        const resultTitle = document.getElementById('resultTitle');
        const resultText = document.getElementById('resultText');
        const currentPromptEl = document.getElementById('currentPrompt');
        
        // --- Drawing Tool State ---
        let currentColor = '#333333';
        let isErasing = false;
        let penSize = 5;
        let eraserSize = 25; 

        // UI elements for tools
        const colorPicker = document.getElementById('colorPicker');
        const penBtn = document.getElementById('penBtn');
        const eraserBtn = document.getElementById('eraserBtn');
        const penSizeSlider = document.getElementById('penSizeSlider');
        const eraserSizeSlider = document.getElementById('eraserSizeSlider');
        
        let isDrawing = false;
        let currentMode = 1; // 1: Free Draw & Guess, 2: Prompted Draw & Rate
        let currentChallenge = '';
        
        // --- EXPANDED LIST OF CHALLENGE WORDS (180+ items) ---
        const challengeList = [
            'Apple', 'Banana', 'Carrot', 'Dolphin', 'Elephant', 'Frog', 'Guitar', 'Hat', 'Ice Cream', 'Jellyfish',
            'Kite', 'Laptop', 'Mushroom', 'Noodle', 'Owl', 'Pineapple', 'Queen', 'Robot', 'Star', 'Taco',
            'Umbrella', 'Volcano', 'Watermelon', 'Xylophone', 'Yacht', 'Zebra', 'Airplane', 'Balloon', 'Camera', 'Diamond',
            'Eel', 'Feather', 'Globe', 'Hammer', 'Island', 'Jacket', 'Kangaroo', 'Lighthouse', 'Magnet', 'Necklace',
            'Octopus', 'Penguin', 'Quill', 'Rocket', 'Snowman', 'Train', 'Unicorn', 'Violin', 'Window', 'Wrench',
            'Anvil', 'Bee', 'Castle', 'Dice', 'Egg', 'Fence', 'Grapes', 'Hedgehog', 'Igloo', 'Jar',
            'Key', 'Lemon', 'Mitten', 'Net', 'Orange', 'Pencil', 'Question Mark', 'Ring', 'Snail', 'Tent',
            'Toothbrush', 'Vase', 'Wagon', 'Yo-yo', 'Zipper', 'Acorn', 'Book', 'Candle', 'Cloud', 'Dinosaur',
            'Door', 'Fireplace', 'Fork', 'Glasses', 'House', 'Insects', 'Juice Box', 'Kettle', 'Ladder', 'Moon',
            'Nail', 'Pizza', 'Sofa', 'Spoon', 'Sun', 'Table', 'Television', 'Tire', 'Tooth', 'Traffic Light',
            'Tree', 'Truck', 'Turtle', 'Watch', 'Whale', 'Whisk', 'Yarn', 'Backpack', 'Baseball Bat', 'Bowling Pin',
            'Bridge', 'Broccoli', 'Bus', 'Cactus', 'Crayon', 'Crown', 'Cupcake', 'Donut', 'Drum', 'Envelope',
            'Fan', 'Flashlight', 'Fox', 'Glove', 'Helmet', 'Jigsaw Puzzle', 'Lollipop', 'Microscope', 'Mirror', 'Mountain',
            'Mouse', 'Paintbrush', 'Pants', 'Pillow', 'Pretzel', 'Pumkin', 'Radio', 'Rainbow', 'Roller Skate', 'Scissors',
            'Shoe', 'Siren', 'Skateboard', 'Spaceship', 'Spider', 'Stairs', 'Stop Sign', 'Suitcase', 'Swing', 'Telescope',
            'Tractor', 'Trombone', 'Trophy', 'Wallet', 'Washing Machine', 'Worm', 'Anchor', 'Blender', 'Boots', 'Bucket',
            'Cabinet', 'Canoe', 'Compass', 'Crab', 'Desk', 'Eagle', 'Headphones', 'Hot Dog', 'Juggling Balls', 'Keyboard',
            'Lobster', 'Microphone', 'Nose', 'Popsicle', 'Sack', 'Saucepan', 'Seashell', 'Shirt', 'Snake', 'Spiral',
            'Squid', 'Stool', 'Street Lamp', 'Submarine', 'Swan', 'Sword', 'Teapot', 'Tiger', 'Toast', 'Towel',
            'Unicycle', 'Vulture', 'Wallet', 'Wrench', 'Castle', 'Fence', 'Mug', 'Ship', 'Sock', 'Zipper',
            'Camera', 'T-shirt', 'Globe', 'Lantern', 'Tent', 'Muffin', 'Cookie', 'Sailboat', 'Snowflake'
        ];
        // -----------------------------------------------------------------


        // --- Event Listeners for Tool Sliders ---
        penSizeSlider.addEventListener('input', (e) => {
            penSize = parseInt(e.target.value);
            if (!isErasing) {
                updateToolUI();
            }
        });

        eraserSizeSlider.addEventListener('input', (e) => {
            eraserSize = parseInt(e.target.value);
            if (isErasing) {
                updateToolUI();
            }
        });


        // Helper to check if the canvas is blank
        function isCanvasBlank() {
            // Note: This check only works for white backgrounds.
            const pixelBuffer = new Uint32Array(ctx.getImageData(0, 0, canvas.width, canvas.height).data.buffer);
            return !pixelBuffer.some(color => color !== 0);
        }

        function toggleSubmitButton() {
            // Only enable if API Key is set AND canvas is not blank
            submitBtn.disabled = !isApiKeySet || isCanvasBlank();
        }

        // --- Tool Functions ---

        function updateToolUI() {
            // Reset Tailwind classes for both buttons
            penBtn.className = "tool-button px-4 py-2 rounded-lg font-semibold transition-all duration-150";
            eraserBtn.className = "tool-button px-4 py-2 rounded-lg font-semibold transition-all duration-150";

            if (isErasing) {
                // Eraser mode is active: drawing in white (canvas background color)
                ctx.strokeStyle = '#FFFFFF'; 
                ctx.lineWidth = eraserSize; // Use adjustable eraser size
                eraserBtn.classList.add('bg-blue-600', 'hover:bg-blue-700', 'text-white', 'shadow-md');
                penBtn.classList.add('text-gray-700', 'border-2', 'border-gray-400', 'hover:bg-gray-100', 'bg-white');
            } else {
                // Pen mode is active
                ctx.strokeStyle = currentColor; // Use adjustable color
                ctx.lineWidth = penSize; // Use adjustable pen size
                penBtn.classList.add('bg-blue-600', 'hover:bg-blue-700', 'text-white', 'shadow-md');
                eraserBtn.classList.add('text-gray-700', 'border-2', 'border-gray-400', 'hover:bg-gray-100', 'bg-white');
            }
            ctx.lineCap = 'round'; // Ensure line cap is always round
        }
        
        function setPenMode() {
            isErasing = false;
            updateToolUI();
        }

        function setEraserMode() {
            isErasing = true;
            updateToolUI();
        }

        colorPicker.addEventListener('input', (e) => {
            currentColor = e.target.value;
            setPenMode(); // Automatically switch to pen mode with new color
        });

        // Expose to global scope for HTML
        window.setPenMode = setPenMode;
        window.setEraserMode = setEraserMode;

        // --- Drawing Logic ---

        function getMousePos(event) {
            const rect = canvas.getBoundingClientRect();
            // Handle touch event if provided
            const clientX = event.touches ? event.touches[0].clientX : event.clientX;
            const clientY = event.touches ? event.touches[0].clientY : event.clientY;
            
            // Scale coordinates to actual canvas resolution if display size is different
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            
            return {
                x: (clientX - rect.left) * scaleX,
                y: (clientY - rect.top) * scaleY
            };
        }

        function startDrawing(e) {
            e.preventDefault();
            if (!isApiKeySet) return; // Prevent drawing if key is missing
            isDrawing = true;
            const pos = getMousePos(e);
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
        }

        function draw(e) {
            if (!isDrawing) return;
            e.preventDefault();
            const pos = getMousePos(e);
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
        }

        function stopDrawing() {
            isDrawing = false;
            ctx.closePath();
            toggleSubmitButton();
        }

        // Add event listeners for both mouse and touch
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);

        canvas.addEventListener('touchstart', startDrawing);
        canvas.addEventListener('touchmove', draw);
        canvas.addEventListener('touchend', stopDrawing);
        canvas.addEventListener('touchcancel', stopDrawing);


        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            resultBox.classList.add('hidden');
            toggleSubmitButton();
        }
        
        // --- Canvas Initialization and Resizing ---
        function resizeCanvas() {
            // Set canvas display size responsively
            const containerWidth = canvas.parentNode.clientWidth;
            // Maintain a square canvas aspect ratio based on the container width, max 400px
            const size = Math.min(containerWidth, 400); 
            canvas.style.width = `${size}px`;
            canvas.style.height = `${size}px`;
            
            // Save current drawing, resize, and restore (prevents clearing on resize)
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            
            // Set internal resolution (fixed for consistency with the model)
            canvas.width = 400;
            canvas.height = 400;
            
            ctx.putImageData(imageData, 0, 0);
            
            // Reapply drawing settings
            updateToolUI();
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        toggleSubmitButton(); // Initial check

        // --- Game Mode Logic ---

        function setMode(mode) {
            currentMode = mode;
            
            // Reset mode buttons styling
            document.getElementById('mode1Btn').classList.remove('bg-blue-600', 'text-white', 'border-2', 'border-blue-600', 'hover:bg-blue-700', 'hover:bg-blue-50');
            document.getElementById('mode1Btn').classList.add('text-blue-600', 'font-semibold', 'border-2', 'border-blue-600', 'hover:bg-blue-50');
            document.getElementById('mode2Btn').classList.remove('bg-blue-600', 'text-white', 'border-2', 'border-blue-600', 'hover:bg-blue-700', 'hover:bg-blue-50');
            document.getElementById('mode2Btn').classList.add('text-blue-600', 'font-semibold', 'border-2', 'border-blue-600', 'hover:bg-blue-50');

            if (mode === 1) {
                document.getElementById('mode1Btn').classList.add('bg-blue-600', 'text-white', 'hover:bg-blue-700');
                document.getElementById('mode1Btn').classList.remove('text-blue-600', 'border-2', 'border-blue-600');
                document.getElementById('mode2Prompt').classList.add('hidden');
                submitText.textContent = "Guess My Drawing";
                currentChallenge = '';
            } else {
                document.getElementById('mode2Btn').classList.add('bg-blue-600', 'text-white', 'hover:bg-blue-700');
                document.getElementById('mode2Btn').classList.remove('text-blue-600', 'border-2', 'border-blue-600');
                document.getElementById('mode2Prompt').classList.remove('hidden');
                submitText.textContent = "Submit for Rating";
                setNewChallenge();
            }
            clearCanvas();
        }

        function setNewChallenge() {
            const randomIndex = Math.floor(Math.random() * challengeList.length);
            currentChallenge = challengeList[randomIndex];
            currentPromptEl.textContent = currentChallenge.toUpperCase();
        }

        // Set initial mode and tools
        setMode(1);
        updateToolUI(); // Ensure tools are styled correctly on load

        // --- API Interaction (Multimodal) ---

        function getBase64Image() {
            // Get data URL and extract base64 part
            const dataUrl = canvas.toDataURL('image/png');
            return dataUrl.split(',')[1];
        }

        async function submitDrawing() {
            if (!isApiKeySet || isCanvasBlank()) {
                console.error('API Key is missing or canvas is blank.'); 
                return;
            }

            submitBtn.disabled = true;
            spinner.classList.remove('hidden');
            submitText.textContent = currentMode === 1 ? "AI Thinking..." : "Rating Drawing...";
            resultBox.classList.add('hidden');
            
            const base64Image = getBase64Image();
            
            let systemPrompt;
            let userQuery;

            if (currentMode === 1) {
                // Mode 1: Guess what the user drew (classification)
                systemPrompt = "You are an expert sketch recognition AI. Your task is to identify the object in the provided drawing. Respond ONLY with the single, most likely word or phrase for what the image depicts. Do not add any extra text, confidence scores, or sentences.";
                userQuery = "What is the object drawn in this image?";
            } else {
                // Mode 2: Rate how well the drawing matches the prompt (scoring)
                systemPrompt = `You are a drawing critique AI. Your task is to assess how accurately the provided image matches the concept: "${currentChallenge}". Respond ONLY with the rating percentage (from 0% to 100%) followed by a space and a brief, encouraging comment. Example: '90% Great work!'`;
                userQuery = `Rate this drawing of a "${currentChallenge}".`;
            }

            const payload = {
                contents: [
                    {
                        role: "user",
                        parts: [
                            { text: userQuery },
                            {
                                inlineData: {
                                    mimeType: "image/png",
                                    data: base64Image
                                }
                            }
                        ]
                    }
                ],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            let result = '';
            let attempts = 0;
            const maxAttempts = 5;

            while (attempts < maxAttempts) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const jsonResult = await response.json();
                    
                    // Extract the text response
                    result = jsonResult.candidates?.[0]?.content?.parts?.[0]?.text || 'Error: Could not process response.';
                    break; // Exit loop on success

                } catch (error) {
                    attempts++;
                    console.error(`Attempt ${attempts} failed:`, error);
                    if (attempts < maxAttempts) {
                        const delay = Math.pow(2, attempts) * 1000; // Exponential backoff
                        await new Promise(resolve => setTimeout(resolve, delay));
                    } else {
                        result = 'Sorry, the AI service is currently unavailable. Please try again later.';
                    }
                }
            }

            // --- Display Result ---
            resultBox.classList.remove('hidden');
            
            if (currentMode === 1) {
                // Mode 1 Result: Guess
                resultTitle.textContent = "AI's Guess:";
                resultTitle.classList.remove('text-green-600', 'text-red-600');
                resultTitle.classList.add('text-blue-600');
                resultText.textContent = result.trim();
                
            } else {
                // Mode 2 Result: Rating
                
                // Parsing for percentage and comment
                const parts = result.trim().split(' ');
                const percentageText = parts[0]; 
                const match = percentageText.match(/(\d{1,3})%/);
                let percentage = match ? parseInt(match[1]) : 0;
                let comment = parts.slice(1).join(' ').trim(); 
                
                if (comment.length === 0 && percentage > 0) {
                    comment = "The AI gave a score but no specific comment. Keep practicing!";
                } else if (comment.length === 0 && percentage === 0) {
                    comment = "The AI couldn't rate the drawing. Try a clearer sketch!";
                }

                resultTitle.textContent = `Match Score: ${percentage}%`;
                
                if (percentage >= 70) {
                    resultTitle.classList.remove('text-red-600', 'text-blue-600');
                    resultTitle.classList.add('text-green-600');
                } else {
                    resultTitle.classList.remove('text-green-600', 'text-blue-600');
                    resultTitle.classList.add('text-red-600');
                }
                
                resultText.textContent = comment;

                // Give a new challenge after rating
                setNewChallenge();
            }

            // Reset UI
            spinner.classList.add('hidden');
            submitText.textContent = currentMode === 1 ? "Guess My Drawing" : "Submit for Rating";
            submitBtn.disabled = false;
        }

    </script>
</body>
</html>
